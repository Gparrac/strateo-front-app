import{_,m as y,n as D,q as t,w as o,z as S,F as p,aD as F,B as z,P as N,V as H,aE as Y,aF as q,aG as T,aH as j,aI as C,K as v,aA as g,M as R,Q as K,S as w,aJ as b,aK as m,R as P,W as L,Y as k,N as V,X as x,aL as A,D as n,aM as O,aN as I}from"./index-9bec7f0e.js";const M={props:{icon:{type:String,default:"mdi-shape"},title:{type:String,default:"-"},value:{type:Number}}};function G(e,a,i,l,c,r){return y(),D("div",null,[t(H,{class:"w-100"},{title:o(()=>[S(p(i.title),1)]),append:o(()=>[t(F,{color:"blue-darken-2"},{default:o(()=>[t(z,{icon:i.icon},null,8,["icon"])]),_:1})]),default:o(()=>[t(N,{class:"text-h3 py-5 mb-5"},{default:o(()=>[S(p(i.value??"-"),1)]),_:1})]),_:1})])}const J=_(M,[["render",G]]);class U{constructor(){this.token=!0,this.petition=new Y,this.route="/analytics"}read(a="",i=""){return this.petition.get(this.route+a,i,this.token)}}const f=q("analyticDate",{state:()=>({startDate:T(void 0,10),endDate:T(),keyUpdate:0}),getters:{castStart:e=>(a=!1)=>j(a?e.startDate:e.endDate)},actions:{saveDateRange(){this.keyUpdate+=1}}}),$=new U,Q={components:{HeaderCard:J},data:()=>({cards:[{title:"Clientes totales",icon:"mdi-account-group-outline",value:0},{title:"Empleados activos",icon:"mdi-account-group",value:0},{title:"Eventos realizados",icon:"mdi-map",value:0}],keySuscribeUpdate:0}),methods:{...C(f,["$subscribe"]),async setTotalClient(){const e=this.analyticDateStore.castStart(!0),i=`option=TA&end_date=${this.analyticDateStore.castStart(!1)}&start_date=${e}`,l=(await $.read("/client",i)).data,c=(await $.read("/seller",i)).data,r=(await $.read("/invoice",i)).data;this.cards[0].value=l,this.cards[1].value=c,this.cards[2].value=r}},computed:{...v(f)},async mounted(){try{this.$subscribe(async(e,a)=>{e.storeId=="analyticDate"&&a.keyUpdate!=this.keySuscribeUpdate&&(this.keySuscribeUpdate=a.keyUpdate,await Promise.all([this.setTotalClient()]))}),await this.setTotalClient()}catch(e){console.error(e)}}};function W(e,a,i,l,c,r){const d=g("header-card");return y(),R(b,{class:"justify-center g-5"},{default:o(()=>[(y(!0),D(w,null,K(e.cards,(s,u)=>(y(),R(m,{cols:"12",sm:"6",md:"4",class:"px-4",key:`${u}-card`},{default:o(()=>[t(d,{class:"",icon:s.icon,title:s.title,value:s.value},null,8,["icon","title","value"])]),_:2},1024))),128))]),_:1})}const X=_(Q,[["render",W]]),E=new U,Z={data:()=>({rulesValidation:P,recordsPerPage:5,totalRecords:0,currentlyPage:1,loading:!1,keyword:"",headers:[{title:"ID",align:"start",key:"id",sortable:!0},{title:"Cliente",align:"start",key:"third",sortable:!0},{title:"Representante legal",align:"left",key:"rl",sortable:!0},{title:"Compras",align:"end",key:"purchases",sortable:!1}],records:[],keyChart:0,keySuscribeUpdate:0,series:[{name:"Compras de realizada",data:[]}],chartOptions:{chart:{height:350,type:"bar"},plotOptions:{bar:{borderRadius:10,dataLabels:{position:"top"}}},dataLabels:{enabled:!0,offsetY:-20,style:{fontSize:"12px",colors:["#304758"]}},xaxis:{categories:[],position:"top",axisBorder:{show:!1},axisTicks:{show:!1},crosshairs:{fill:{type:"gradient",gradient:{colorFrom:"#D8E3F0",colorTo:"#BED1E6",stops:[0,100],opacityFrom:.4,opacityTo:.5}}},tooltip:{enabled:!0}},yaxis:{axisBorder:{show:!1},axisTicks:{show:!1},labels:{show:!1}},title:{text:"5 clientes con más compras en este periodo",floating:!0,offsetY:330,align:"center",style:{color:"#444"}}}}),computed:{...v(f)},methods:{...C(f,["$subscribe"]),async searchData(){this.loading=!0;const{valid:e}=await this.$refs.formSearchCustomer.validate();e||(this.keyword=""),await this.loadItems({page:1}),this.loading=!1},async loadItems({page:e=this.currentlyPage,itemsPerPage:a=this.recordsPerPage},i=this.keyword){this.loading=!0;const l=this.analyticDateStore.castStart(!0),c=this.analyticDateStore.castStart(!1),r=new URLSearchParams;r.append("page",e),r.append("pagination",a),r.append("option","LA"),r.append("start_date",l),r.append("end_date",c),i&&i.length>0&&r.append("keyword",i);const d=(await E.read("/client",r.toString())).data;d.data&&(this.records=d.data),this.keyword=i,this.currentlyPage=e,this.recordsPerPage=d.per_page,this.totalRecords=d.total,this.loading=!1},async setTopClients(){const e=this.analyticDateStore.castStart(!0),i=`option=LS&end_date=${this.analyticDateStore.castStart(!1)}&start_date=${e}`,l=await E.read("/client",i);l.data?(this.series[0].data=l.data.invoices,this.chartOptions.xaxis.categories=l.data.customers):(this.series[0].data=[],this.chartOptions.xaxis.categories=[]),this.$refs.chart.updateOptions(this.chartOptions)}},async mounted(){this.$subscribe(async(e,a)=>{e.storeId=="analyticDate"&&a.keyUpdate!=this.keySuscribeUpdate&&(this.keySuscribeUpdate=a.keyUpdate,await Promise.all([this.loadItems({page:1}),this.setTopClients()]))}),await this.setTopClients()}},ee=n("h3",{class:""},"Participación de clientes",-1),te={class:"block text-subtitle-2"},ae=n("br",null,null,-1),se={class:"block text-body-2 text-blue-grey-lighten-3"},re={class:"block text-subtitle-2"},oe=n("br",null,null,-1),ie={class:"block text-body-2 text-blue-grey-lighten-3"},ne={id:"chart"};function le(e,a,i,l,c,r){const d=g("apexchart");return y(),D(w,null,[t(x,{ref:"formSearchCustomer",class:"d-flex mt-5 py-5"},{default:o(()=>[ee,t(L),t(k,{type:"text",variant:"outlined",label:"Busca un cliente ...",rules:e.rulesValidation.text.rules,modelValue:e.keyword,"onUpdate:modelValue":a[0]||(a[0]=s=>e.keyword=s),density:"compact",hint:"Busca por nombre de cliente o número de documento","persistent-hint":""},null,8,["rules","modelValue"]),t(V,{onClick:r.searchData,icon:"mdi-table-search",color:"primary",class:"ml-3",size:"small",variant:"tonal"},null,8,["onClick"])]),_:1},512),t(b,{"align-content":"center"},{default:o(()=>[t(m,{cols:"12",md:"6"},{default:o(()=>[t(A,{headers:e.headers,items:e.records,"onUpdate:options":r.loadItems,"items-length":e.totalRecords,"items-per-page":e.recordsPerPage,"onUpdate:itemsPerPage":a[1]||(a[1]=s=>e.recordsPerPage=s),loading:e.loading,"items-per-page-options":[5],"return-object":"","items-per-page-text":"Items por Página"},{"item.third":o(({item:s})=>{var u,h;return[n("div",null,[n("span",te,p((u=s==null?void 0:s.third)==null?void 0:u.fullname),1),ae,n("span",se,p((h=s==null?void 0:s.third)==null?void 0:h.fullid),1)])]}),"item.rl":o(({item:s})=>[n("div",null,[n("span",re,p(s==null?void 0:s.legal_representative_name),1),oe,n("span",ie,p(s==null?void 0:s.legal_representative_id),1)])]),"item.purchases":o(({item:s})=>[n("div",null,[t(O,{variant:"tonal",class:"ma-1",label:"",color:"primary"},{default:o(()=>[S(p(s.invoices_count),1)]),_:2},1024)])]),_:2},1032,["headers","items","onUpdate:options","items-length","items-per-page","loading"])]),_:1}),t(m,{cols:"12",md:"6"},{default:o(()=>[n("div",ne,[t(d,{ref:"chart",id:e.keyChart,type:"bar",height:"350",options:e.chartOptions,series:e.series},null,8,["id","options","series"])])]),_:1})]),_:1})],64)}const de=_(Z,[["render",le]]),B=new U,ce={data:()=>({rulesValidation:P,recordsPerPage:5,totalRecords:0,currentlyPage:1,loading:!1,keyword:"",headers:[{title:"ID",align:"start",key:"id",sortable:!0},{title:"Cliente",align:"start",key:"third",sortable:!0},{title:"Nombre de usuario",align:"center",key:"name",sortable:!0},{title:"Compras",align:"end",key:"purchases",sortable:!1}],records:[],keyChart:0,keySuscribeUpdate:0,series:[{name:"Compras de realizada",data:[]}],chartOptions:{chart:{height:350,type:"bar"},plotOptions:{bar:{borderRadius:4,borderRadiusApplication:"end",horizontal:!0}},dataLabels:{enabled:!0,offsetY:-2,style:{fontSize:"12px",colors:["#304758"]}},xaxis:{categories:[],position:"top",axisBorder:{show:!1},axisTicks:{show:!1},crosshairs:{fill:{type:"gradient",gradient:{colorFrom:"#AD1457",colorTo:"#AD1457",stops:[0,100],opacityFrom:.4,opacityTo:.5}}},tooltip:{enabled:!0}},yaxis:{axisBorder:{show:!1},axisTicks:{show:!1},labels:{show:!1}},title:{text:"5 vendedores con más compras en este periodo",floating:!0,offsetY:330,align:"center",style:{color:"#444"}},colors:["#E91E63"]}}),computed:{...v(f)},methods:{...C(f,["$subscribe"]),async searchData(){this.loading=!0;const{valid:e}=await this.$refs.formSearchCustomer.validate();e||(this.keyword=""),await this.loadItems({page:1}),this.loading=!1},async loadItems({page:e=this.currentlyPage,itemsPerPage:a=this.recordsPerPage},i=this.keyword){this.loading=!0;const l=this.analyticDateStore.castStart(!0),c=this.analyticDateStore.castStart(!1),r=new URLSearchParams;r.append("page",e),r.append("pagination",a),r.append("option","LA"),r.append("start_date",l),r.append("end_date",c),i&&i.length>0&&r.append("keyword",i);const d=(await B.read("/seller",r.toString())).data;d.data&&(this.records=d.data),this.keyword=i,this.currentlyPage=e,this.recordsPerPage=d.per_page,this.totalRecords=d.total,this.loading=!1},async setTopClients(){const e=this.analyticDateStore.castStart(!0),i=`option=LS&end_date=${this.analyticDateStore.castStart(!1)}&start_date=${e}`,l=await B.read("/seller",i);l.data?(this.series[0].data=l.data.invoices,this.chartOptions.xaxis.categories=l.data.customers):(this.series[0].data=[],this.chartOptions.xaxis.categories=[]),this.$refs.chart.updateOptions(this.chartOptions)}},async mounted(){this.$subscribe(async(e,a)=>{e.storeId=="analyticDate"&&a.keyUpdate!=this.keySuscribeUpdate&&(this.keySuscribeUpdate=a.keyUpdate,await Promise.all([this.loadItems({page:1}),this.setTopClients()]))}),await this.setTopClients()}},pe=n("h3",{class:""},"Participación de clientes",-1),ue={class:"block text-subtitle-2"},he=n("br",null,null,-1),me={class:"block text-body-2 text-blue-grey-lighten-3"},ye={id:"chart"};function fe(e,a,i,l,c,r){const d=g("apexchart");return y(),D(w,null,[t(x,{ref:"formSearchCustomer",class:"d-flex mt-5 py-5"},{default:o(()=>[pe,t(L),t(k,{type:"text",variant:"outlined",label:"Busca un vendedor ...",rules:e.rulesValidation.text.rules,modelValue:e.keyword,"onUpdate:modelValue":a[0]||(a[0]=s=>e.keyword=s),density:"compact",hint:"Busca por nombre de vendedor o número de documento","persistent-hint":""},null,8,["rules","modelValue"]),t(V,{onClick:r.searchData,icon:"mdi-table-search",color:"primary",class:"ml-3",size:"small",variant:"tonal"},null,8,["onClick"])]),_:1},512),t(b,{"align-content":"center",class:"flex-row-reverse"},{default:o(()=>[t(m,{cols:"12",md:"6"},{default:o(()=>[t(A,{headers:e.headers,items:e.records,"onUpdate:options":r.loadItems,"items-length":e.totalRecords,"items-per-page":e.recordsPerPage,"onUpdate:itemsPerPage":a[1]||(a[1]=s=>e.recordsPerPage=s),loading:e.loading,"items-per-page-options":[5],"return-object":"","items-per-page-text":"Items por Página"},{"item.third":o(({item:s})=>{var u,h;return[n("div",null,[n("span",ue,p((u=s==null?void 0:s.third)==null?void 0:u.fullname),1),he,n("span",me,p((h=s==null?void 0:s.third)==null?void 0:h.fullid),1)])]}),"item.purchases":o(({item:s})=>[n("div",null,[t(O,{variant:"tonal",class:"ma-1",label:"",color:"pink"},{default:o(()=>[S(p(s.invoices_count),1)]),_:2},1024)])]),_:2},1032,["headers","items","onUpdate:options","items-length","items-per-page","loading"])]),_:1}),t(m,{cols:"12",md:"6"},{default:o(()=>[n("div",ye,[t(d,{ref:"chart",id:e.keyChart,type:"bar",height:"350",options:e.chartOptions,series:e.series},null,8,["id","options","series"])])]),_:1})]),_:1})],64)}const ge=_(ce,[["render",fe]]),be={components:{HeaderListCard:X,CustomerSection:de,SellerSection:ge},data:()=>({rulesValidation:P}),computed:{startDateRule(){return[...this.rulesValidation.date.rules,a=>this.endDate?new Date(a)<new Date(this.analyticDateStore.endDate)||"La fecha de inicio debe ser menor a la de finalización. ":!0]},endDateRule(){return[...this.rulesValidation.date.rules,e=>new Date(e)>new Date(this.analyticDateStore.startDate)||"La fecha de finalización debe ser mayor a la de inicio. "]},...v(f)},methods:{async setDate(){const{valid:e}=await this.$refs.formDates.validate();e&&this.analyticDateStore.saveDateRange()}},mounted(){}},_e=n("h1",null,"Bienvenido a Strateo-app",-1),De=n("h3",null,"Rango de fechas para estudiar",-1);function Se(e,a,i,l,c,r){const d=g("HeaderListCard"),s=g("CustomerSection"),u=g("seller-section");return y(),D(w,null,[t(b,{class:"pb-10"},{default:o(()=>[t(m,{cols:"12",md:"6"},{default:o(()=>[_e,De]),_:1}),t(m,{cols:"12",md:"6"},{default:o(()=>[t(x,{ref:"formDates"},{default:o(()=>[t(b,null,{default:o(()=>[t(m,{cols:"12",sm:"6",md:"6"},{default:o(()=>[t(k,{type:"date",variant:"outlined",label:"Fecha de inicio",rules:r.startDateRule,modelValue:e.analyticDateStore.startDate,"onUpdate:modelValue":a[0]||(a[0]=h=>e.analyticDateStore.startDate=h)},null,8,["rules","modelValue"])]),_:1}),t(m,{cols:"12",sm:"6",md:"6",class:"d-flex"},{default:o(()=>[t(k,{type:"date",variant:"outlined",label:"Fecha de finalización",rules:r.endDateRule,modelValue:e.analyticDateStore.endDate,"onUpdate:modelValue":a[1]||(a[1]=h=>e.analyticDateStore.endDate=h)},null,8,["rules","modelValue"]),n("div",null,[t(V,{onClick:r.setDate,icon:"mdi-reload",color:"deep-purple-accent-4",class:"ml-3",variant:"tonal"},null,8,["onClick"])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),t(d),t(s),t(I,{class:"my-5",thickness:3,color:"info"}),t(u),t(I,{class:"my-5",thickness:3,color:"info"})],64)}const ve=_(be,[["render",Se]]);export{ve as default};
